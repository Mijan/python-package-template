[tox]
min_version = 4.0
env_list =
    py312
    lint
    type
    docs
    format_check
    format

[testenv]
description = Run unit tests with coverage
package = editable
extras = test
deps =
commands_pre =
    python -c "import os; os.makedirs('test-results', exist_ok=True)"
commands =
    pytest --durations=10 --junitxml=test-results/pytest-results-{envname}.xml --cov=src/package_name --cov-report=html:test-results/coverage --cov-report=xml:test-results/coverage.xml tests -vv
    python -m coverage report -m

[testenv:lint]
description = Lint (ruff)
skip_install = true
deps = ruff
commands =
    ruff check src/package_name tests

[testenv:format_check]
description = Check formatting (ruff)
skip_install = true
deps = ruff
commands =
    ruff format --check src/package_name tests
    ruff check src/package_name tests

[testenv:format]
description = Auto-format + auto-fix safe issues (ruff)
skip_install = true
deps = ruff
commands =
    ruff format src/package_name tests
    ruff check --fix src/package_name tests

[testenv:type]
description = Type-check (mypy)
skip_install = true
deps = mypy
commands =
    mypy src/package_name

[testenv:docs]
description = Docstring coverage gate (interrogate)
skip_install = true
deps = interrogate
commands =
    interrogate src/package_name
