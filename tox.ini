# Generic, tox setup for a "src/"-layout Python package.
# Replace "package_name" once when you instantiate the template.
# Works for local installs (editable) and CI.

[tox]
min_version = 4.0
env_list =
    py312
    lint
    type
    format_check
    docs_check

# Default test env
[testenv]
description = Run unit tests with coverage
package = editable
extras = test
deps =
    pytest
    pytest-cov
    pytest-benchmark
    pytest-profiling
commands_pre =
    python -c "import os; os.makedirs('test-results', exist_ok=True)"
commands =
    pytest \
      --durations=10 \
      --junitxml=test-results/pytest-results-{envname}.xml \
      --benchmark-disable \
      --cov=src/package_name \
      --cov-report=html:test-results/coverage \
      --cov-report=xml:test-results/coverage.xml \
      tests -vv
    python -m coverage report -m

# Linting (flake8)
[testenv:lint]
description = Lint (flake8)
skip_install = true
deps =
    flake8
    flake8-docstrings
commands_pre =
    python -c "import os; os.makedirs('test-results', exist_ok=True)"
commands =
    flake8 src/package_name tests

# Static typing (mypy)
[testenv:type]
description = Type-check (mypy)
skip_install = true
deps =
    mypy
commands =
    mypy --config-file tox.ini src/package_name

# Formatting check (black + isort)
[testenv:format_check]
description = Check formatting (black + isort)
skip_install = true
deps =
    black
    isort
commands =
    isort --profile black --check-only src/package_name tests
    black --check -t py312 src/package_name tests

# Optional: docstring coverage gate (keep/adjust threshold as you like)
[testenv:docs_check]
description = Docstring coverage (interrogate)
skip_install = true
deps =
    interrogate
commands =
    interrogate -v --exclude '**/__init__.py' --fail-under 50 src/package_name

# Auto-format (developer convenience)
[testenv:format]
description = Auto-format (black + isort)
skip_install = true
deps =
    black
    isort
commands =
    isort --profile black src/package_name tests
    black -t py312 src/package_name tests

# --- Tool configs kept here for convenience. You can move these to pyproject.toml later. ---

[flake8]
exclude =
    .tox,
    .venv,
    build,
    dist,
    *.egg,
max-line-length = 88
extend-ignore = E203,W503
ignore = F401,F403,F405,E501
docstring-convention = google
per-file-ignores =
    tests/*:D

[mypy]
python_version = 3.12
ignore_missing_imports = true
warn_return_any = true
warn_unused_ignores = true
disallow_untyped_defs = false
no_implicit_optional = true

[isort]
profile = black
src_paths = src

[black]
line-length = 88
target-version = ['py312']
